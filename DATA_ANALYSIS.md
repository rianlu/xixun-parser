# 戏讯数据分析报告

## 文件位置

已保存的HTML内容文件:
- **原始HTML**: `backend/data/temp_content.html` (964KB)
- **纯文本版本**: `backend/data/temp_content_text.txt` (79KB) ⭐ 推荐查看
- **HTML结构**: `backend/data/temp_content_structure.txt` (10KB)
- **完整JSON**: `backend/data/result_20260120_005106.json` (1.2MB)

## 数据结构分析

### HTML标签统计
- `<span>`: 2,992个
- `<br>`: 1,136个
- `<p>`: 898个段落
- `<section>`: 874个区块
- **无表格** (table: 0)

### 文本内容
- **总行数**: 994行
- **日期数量**: 191个
- **时间数量**: 1个
- **剧场信息**: 13条

## 数据格式示例

从提取的文本来看,戏讯数据格式如下:

### 格式1: 当天演出(详细信息)
```
苍南县大渔镇天后宫【台州市椒江弘艺越剧团】
下午:加演《祭塔》正本《王老虎抢亲》
晚上:加演《歌舞》正本《荆钗记》
（演出第3天）
```

### 格式2: 未来演出(简略信息)
```
（2026年1月20日<农历十二月初二>）乐清市大荆镇李宅基村【台州市中樾越剧团】
```

### 格式3: 未来演出(带剧目)
```
（2026年1月22日<农历十二月初四>）温州市龙湾区高远张氏祠堂【温州市越剧院】
（1月22日）下午:正本《追鱼》晚上:正本《荆钗记》
（1月23日）下午:正本《白兔记》晚上:正本《胭脂》
（1月24日）下午:正本《宝莲灯》晚上:正本《五女拜寿》
```

## 数据字段识别

从文本分析,每条戏讯包含:

1. **日期**: 
   - 格式: `2026年1月19日` 或 `1月19日`
   - 农历: `<农历十二月初一>`

2. **地点**: 
   - 格式: `城市 + 区/镇 + 村/具体地点`
   - 例: `苍南县大渔镇天后宫`

3. **剧团**: 
   - 格式: `【剧团名称】`
   - 例: `【台州市椒江弘艺越剧团】`

4. **剧目** (可选):
   - 格式: `下午:加演《xxx》正本《xxx》`
   - 格式: `晚上:加演《xxx》正本《xxx》`

5. **演出天数** (可选):
   - 格式: `（演出第X天）`

## 数据提取建议

### 正则表达式模式

```python
# 日期模式
date_pattern = r'(\d{4}年)?\d{1,2}月\d{1,2}日'
lunar_pattern = r'<农历[^>]+>'

# 地点模式  
venue_pattern = r'([^【（\n]+)【'

# 剧团模式
troupe_pattern = r'【([^】]+)】'

# 剧目模式
play_pattern = r'(下午|晚上):.*?《([^》]+)》'

# 演出天数
day_pattern = r'（演出第(\d+)天）'
```

### 解析策略

1. **按段落分组**: 每个演出信息通常占2-4行
2. **识别起始标志**: 
   - 包含日期的行
   - 包含【剧团】的行
3. **提取相关信息**: 从起始行开始,向下读取2-4行作为一组
4. **字段提取**: 使用正则表达式提取各字段

## 推荐查看文件

**最易读**: `backend/data/temp_content_text.txt`

这个文件包含了所有提取的纯文本,没有HTML标签,可以直接查看数据格式。

用文本编辑器打开:
```bash
open backend/data/temp_content_text.txt
```

或使用命令行查看:
```bash
cat backend/data/temp_content_text.txt | head -100
```

## 下一步优化

根据分析结果,需要在 `backend/parser.py` 的 `_extract_performances` 方法中:

1. 按段落分组文本
2. 识别包含【剧团】的行作为起始
3. 提取日期、地点、剧团、剧目等字段
4. 处理多日演出的情况
5. 返回结构化数据

建议先查看 `temp_content_text.txt` 文件,了解完整的数据格式后,再优化解析逻辑。
